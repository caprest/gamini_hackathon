# 🦕 ノージャンプダイナソー - 要件定義書

## 1. ゲーム概要

**タイトル**: ノージャンプダイナソー (No Jump Dinosaur)
**コンセプト**: Google Chrome の Dinosaur Game をベースに、ジャンプの代わりに「AI生成武器」で障害物を破壊して進むサイドスクロールアクションゲーム。
**テクノロジースタック**: Next.js + Phaser.js + Gemini API + Banana API

### コアループ
1. 障害物が右から迫ってくる（Dino Gameライク）
2. プレイヤーが音声/テキストで武器・魔法を叫ぶ
3. Gemini APIが入力を解析し、武器オブジェクトを生成
4. チャージエフェクト中にAI処理完了
5. スペースキーで攻撃発動 → 障害物を破壊
6. タイミングが合えば成功、ズレると死亡

---

## 2. ゲームフロー

```
[タイトル画面]
    ↓
[キャラクター作成] ← テキスト入力 → Banana API で画像生成
    ↓
[ゲームプレイ]
    ├── 障害物接近 → 音声/テキスト入力 → AI武器生成（チャージ中）→ スペースで攻撃
    ├── スコア加算・距離増加
    ├── HP/MPゲージ管理
    └── 死亡 → [リザルト画面]
    ↓
[リザルト画面] → リトライ or タイトルへ
```

---

## 3. 画面仕様

### 3.1 タイトル画面
- ゲームタイトル「ノージャンプダイナソー」表示
- 「START」ボタン
- 背景: 砂漠風（Dino Game風）
- BGM: 8bit風

### 3.2 キャラクター作成画面
- テキスト入力欄（例: 「赤い鎧を着たドラゴン戦士」）
- 「生成」ボタン → Banana API で画像生成
- 生成されたキャラクター画像のプレビュー
- 「このキャラで始める」ボタン
- ローディングアニメーション（生成中）

### 3.3 ゲームプレイ画面
```
┌─────────────────────────────────────────────┐
│  HP: ████████░░  MP: ██████░░░░  Score: 1250 │
│                                               │
│                                               │
│   🦕 ─── チャージ中... ───→     🌵   🔥      │
│  ▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔  │
│                                               │
│  [現在の武器: 🗡️ 炎の剣]                      │
│  [💬 音声入力中... / テキスト入力欄]            │
└─────────────────────────────────────────────┘
```
- 上部: HP/MPバー、スコア表示
- 中央: サイドスクロールゲームフィールド
- 下部: 現在装備中の武器、入力UI

### 3.4 リザルト画面
- 最終スコア表示
- 倒した敵の数
- 使った武器一覧（AI生成ログ）
- リトライ / タイトルへ

---

## 4. ゲームメカニクス

### 4.1 攻撃システム

#### 近接武器（MP消費: 低）
- 入力例: 「剣」「ハンマー」「斧」
- 射程: キャラクターの目の前
- 攻撃タイミング: スペースキー押下で即座に振る
- 用途: 近くの障害物・敵

#### 魔法/遠距離攻撃（MP消費: 高）
- 入力例: 「ファイアボール」「雷」「氷の矢」
- 射程: 画面の半分〜全体
- 攻撃タイミング: スペースキー押下で発射
- 用途: 遠くの敵・複数同時破壊

#### チャージシステム（AI応答待ち対策）
1. プレイヤーが音声/テキスト入力
2. 「チャージ中...」エフェクトが発動（キャラが光る、パーティクル）
3. バックグラウンドでGemini API呼び出し
4. API応答完了 → 武器が確定・表示される
5. 「READY!」表示 → スペースキーで攻撃可能

**チャージ中のゲーム状態**:
- 障害物は引き続き迫ってくる（緊張感維持）
- チャージ完了前にスペースを押すと「素手攻撃」（弱い）
- チャージ中にも移動は可能（前後のみ、ジャンプなし）

### 4.2 HP / MP システム

#### HP (ヒットポイント)
- 初期値: 100
- 障害物に衝突: -20〜-50（種類による）
- 回復方法: 特定の入力（例: 「回復薬」）で回復アイテム生成
- HP 0 = ゲームオーバー

#### MP (マジックポイント)
- 初期値: 100
- 近接武器使用: -10〜-20
- 魔法使用: -30〜-50
- 自然回復: 時間経過で+1/秒
- MP不足時: 素手攻撃のみ可能

### 4.3 障害物の種類

| 種類 | HP | スプライト | 出現頻度 | 備考 |
|------|-----|-----------|---------|------|
| サボテン（小） | 10 | 🌵 | 高 | 基本障害物 |
| サボテン（大） | 30 | 🌵🌵 | 中 | 近接武器推奨 |
| 火の壁 | 50 | 🔥 | 低 | 魔法推奨、触れると大ダメージ |
| 棘トラップ | 20 | ⚡ | 中 | 地面設置型 |
| プテラノドン | 40 | 🦅 | 低 | 飛行型、遠距離推奨 |
| ボス（周期的出現） | 200 | 👹 | 極低 | 複数回攻撃必要 |

### 4.4 スコアシステム
- 距離に応じてスコア加算（1m = 1pt）
- 敵撃破ボーナス（敵HPに比例）
- コンボシステム: 連続撃破でボーナス倍率UP
- 武器のユニーク度（AIが判定）でボーナス

---

## 5. AI機能仕様

### 5.1 Gemini API - 武器生成エンジン

**用途**: プレイヤーの入力から武器の属性を決定

**入力**: ユーザーの音声/テキスト（例: 「燃える巨大な剣」）

**出力（JSON）**:
```json
{
  "weapon_name": "炎の大剣",
  "type": "melee",          // "melee" | "ranged" | "magic"
  "damage": 45,             // 10-100
  "mp_cost": 15,            // 5-50
  "range": "short",         // "short" | "medium" | "long"
  "element": "fire",        // "fire" | "ice" | "thunder" | "wind" | "earth" | "light" | "dark" | "none"
  "sprite_description": "赤く燃え上がる巨大な両手剣。刃が炎のオーラに包まれている",
  "attack_animation": "slash_wide",  // "slash" | "slash_wide" | "thrust" | "projectile" | "explosion" | "beam"
  "color": "#FF4500",
  "uniqueness_score": 75    // 0-100（ユニーク度）
}
```

**Gemini プロンプト設計**:
```
あなたはファンタジーゲームの武器デザイナーです。
プレイヤーの入力を元に、ゲーム内で使える武器を生成してください。

ルール:
- 入力がどんなものでも、必ず武器として解釈してください
- 面白い・意外な解釈を歓迎します（例: 「バナナ」→「バナナ型ブーメラン」）
- JSONフォーマットで出力してください
- damage は入力の具体性・独創性に比例させてください

プレイヤーの入力: "{user_input}"
```

### 5.2 Gemini Live API - 音声入力（リアルタイム）

**用途**: プレイヤーの音声をリアルタイムで認識して武器生成につなげる

**フロー**:
1. マイクアイコンクリック or 自動音声認識ON
2. 音声をストリーミングでGemini Live APIに送信
3. 認識テキスト表示（リアルタイムフィードバック）
4. 発話終了検出 → 武器生成APIコール

### 5.3 Banana API - キャラクター画像生成

**用途**: ゲーム開始時のプレイヤーキャラクター生成

**入力**: テキスト説明（例: 「青い鎧を着た恐竜の騎士」）

**プロンプト**:
```
pixel art style, 32x32 sprite, side view, game character,
{user_description}, dinosaur character, 
transparent background, retro game style
```

**出力**: キャラクター画像（スプライト用にリサイズ・加工）

---

## 6. 技術スタック

### フロントエンド
- **Next.js 14** (App Router)
- **Phaser.js 3** （ゲームエンジン、Canvas/WebGL）
- **TypeScript**
- **Tailwind CSS**（UI部分）

### AI / API
- **Gemini API** （武器生成、属性決定）
- **Gemini Live API** （音声認識・リアルタイム入力）
- **Banana API (Nano Banana)** （キャラクター画像生成）

### 音声
- **Web Speech API** （フォールバック用音声認識）
- **Gemini Live API** （メイン音声認識）

### デプロイ
- **Vercel** （Next.jsデプロイ）

---

## 7. ファイル構成（想定）

```
no-jump-dino/
├── app/
│   ├── layout.tsx          # ルートレイアウト
│   ├── page.tsx            # タイトル画面
│   ├── create/
│   │   └── page.tsx        # キャラクター作成画面
│   └── game/
│       └── page.tsx        # ゲームプレイ画面（Phaser埋め込み）
├── components/
│   ├── ui/
│   │   ├── HPBar.tsx       # HPゲージコンポーネント
│   │   ├── MPBar.tsx       # MPゲージコンポーネント
│   │   ├── ScoreDisplay.tsx
│   │   ├── WeaponDisplay.tsx
│   │   └── VoiceInput.tsx  # 音声入力UI
│   └── game/
│       ├── GameCanvas.tsx  # Phaser.jsキャンバスラッパー
│       └── GameOverlay.tsx # HUD（HTMLオーバーレイ）
├── game/
│   ├── scenes/
│   │   ├── BootScene.ts    # アセットロード
│   │   ├── GameScene.ts    # メインゲームシーン
│   │   └── GameOverScene.ts
│   ├── objects/
│   │   ├── Player.ts       # プレイヤーキャラ
│   │   ├── Obstacle.ts     # 障害物基底クラス
│   │   ├── Cactus.ts
│   │   ├── FireWall.ts
│   │   ├── Pteranodon.ts
│   │   └── Weapon.ts       # 武器オブジェクト
│   ├── systems/
│   │   ├── WeaponSystem.ts # 武器管理・攻撃処理
│   │   ├── ScoreSystem.ts  # スコア管理
│   │   ├── HPMPSystem.ts   # HP/MP管理
│   │   └── SpawnSystem.ts  # 障害物スポーン管理
│   └── config.ts           # ゲーム設定
├── lib/
│   ├── gemini.ts           # Gemini API クライアント
│   ├── gemini-live.ts      # Gemini Live API（音声）
│   ├── banana.ts           # Banana API クライアント
│   └── voice.ts            # 音声入力ユーティリティ
├── api/
│   ├── generate-weapon/
│   │   └── route.ts        # 武器生成APIルート
│   ├── generate-character/
│   │   └── route.ts        # キャラ生成APIルート
│   └── voice-to-weapon/
│       └── route.ts        # 音声→武器APIルート
├── public/
│   ├── sprites/            # スプライト画像
│   ├── sounds/             # SE・BGM
│   └── fonts/              # ピクセルフォント
├── types/
│   └── game.ts             # 型定義
├── .env.local              # API キー
├── next.config.js
├── package.json
└── tsconfig.json
```

---

## 8. 優先度と開発フェーズ（5時間計画）

### Phase 1: 基盤構築（0:00〜1:00）⏱️ 1時間
- [ ] Next.js + Phaser.js セットアップ
- [ ] 基本的なサイドスクローラー実装（地面、スクロール）
- [ ] プレイヤーキャラ表示・基本動作
- [ ] 障害物スポーン（サボテン）

### Phase 2: AI武器システム（1:00〜2:30）⏱️ 1.5時間
- [ ] Gemini API 武器生成エンドポイント
- [ ] テキスト入力 → 武器生成フロー
- [ ] チャージエフェクト実装
- [ ] 攻撃アニメーション（基本）
- [ ] HP/MPシステム

### Phase 3: 音声入力（2:30〜3:30）⏱️ 1時間
- [ ] Gemini Live API / Web Speech API 統合
- [ ] 音声認識 → 武器生成パイプライン
- [ ] 音声入力UI

### Phase 4: キャラ生成 & ビジュアル（3:30〜4:15）⏱️ 45分
- [ ] Banana API キャラクター生成
- [ ] キャラ作成画面
- [ ] 各種エフェクト・パーティクル強化
- [ ] 障害物バリエーション追加

### Phase 5: ポリッシュ & デモ準備（4:15〜5:00）⏱️ 45分
- [ ] バグ修正
- [ ] スコア・リザルト画面
- [ ] SE/BGM追加
- [ ] デモ動画撮影（1分）
- [ ] デプロイ

---

## 9. MVP（最小限の動くデモ）

デモで最低限見せたいもの:
1. ✅ サイドスクロールで恐竜が走っている
2. ✅ テキスト入力で武器が生成される（Gemini API）
3. ✅ チャージ → スペースキーで攻撃 → 障害物破壊
4. ✅ HP/MPが機能している
5. ⭐ 音声入力で武器生成（デモのWow Factor）
6. ⭐ Banana APIでキャラクター生成

---

## 10. 審査対策

| 審査基準 | 配点 | 対策 |
|---------|------|------|
| デモ (50%) | 最重要 | 動くゲームを確実に完成。音声入力の実演が最大のインパクト |
| インパクト (25%) | 高 | 「AI×ゲーム」の新しいインタラクション。誰もが知るDino Gameのリミックス |
| 創造性 (15%) | 中 | 「ジャンプしない」逆転の発想。音声で武器を叫ぶ体験 |
| ピッチ (10%) | 低 | 3分で要点。デモ中心。「言葉が武器になる」キャッチコピー |
